{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-5">
    <!-- í”„ë¡œí•„ ì •ë³´ -->
    <div class="profile-header d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center">
            <img src="{{ user.profile.image.url }}" class="rounded-circle profile-img me-3" alt="í”„ë¡œí•„ ì‚¬ì§„">
            <h2 class="mb-0">{{ user.nickname }}ì˜ ì—¬í–‰ì¼ê¸°</h2>
        </div>
    </div>

    <!-- í¸ì§‘ ë“œë¡­ë‹¤ìš´ ë²„íŠ¼ -->
    <div class="edit-dropdown position-relative mt-4">
        <button class="btn btn-outline-secondary">í”„ë¡œí•„ í¸ì§‘</button>
        
        <!-- í˜¸ë²„ ì‹œ ë‚˜íƒ€ë‚˜ëŠ” í¸ì§‘ í¼ -->
        <div class="edit-dropdown-form shadow p-4 bg-light rounded">
            <!-- ë‹‰ë„¤ì„ ìˆ˜ì • í¼ -->
            <form method="post" action="{% url 'profiles:edit_nickname' %}">
                {% csrf_token %}
                <div class="mb-3">
                    <label for="nickname" class="form-label">ìƒˆ ë‹‰ë„¤ì„</label>
                    <input type="text" class="form-control" id="nickname" name="nickname" placeholder="ìƒˆë¡œìš´ ë‹‰ë„¤ì„ ì…ë ¥" required>
                </div>
                <button type="submit" class="btn btn-primary w-100 mb-3">ë‹‰ë„¤ì„ ì €ì¥</button>
            </form>

            <!-- í”„ë¡œí•„ ì‚¬ì§„ ìˆ˜ì • í¼ -->
            <form method="post" action="{% url 'profiles:edit_profile_image' %}" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="mb-3">
                    <label for="profile_image" class="form-label">í”„ë¡œí•„ ì‚¬ì§„ ë³€ê²½</label>
                    <input type="file" class="form-control" id="profile_image" name="profile_image" accept="image/*">
                </div>
                <button type="submit" class="btn btn-primary w-100">ì‚¬ì§„ ì €ì¥</button>
            </form>
        </div>
    </div>
</div>


    <!-- ì¹œêµ¬ ìˆ˜ ë° ë“œë¡­ë‹¤ìš´ -->
    <div class="friends-dropdown mt-4 position-relative">
        <button class="btn btn-outline-info">
            ì¹œêµ¬ {{ friends_count }}ëª…
        </button>
        <div class="friends-list shadow p-3 bg-light rounded">
            {% if friends %}
                <ul class="list-unstyled">
                    {% for friend in friends %}
                    <li class="mb-2">
                        <a href="{% url 'profiles:friend_profile' friend.username %}" class="text-decoration-none">
                            {% if friend.first_name %}
                                {{ friend.first_name }} (@{{ friend.username }})
                            {% else %}
                                {{ friend.username }}
                            {% endif %}
                        </a>
                    </li>
                    
                    {% endfor %}
                </ul>
            {% else %}
                <p>ì•„ì§ ì¹œêµ¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endif %}
        </div>
    </div>

        <!-- ì°œí•œ í•­ëª© ë“œë¡­ë‹¤ìš´ -->
    <div class="wishlist-dropdown mt-4 position-relative">
        <button class="btn btn-outline-success">
            ì°œí•œ í•­ëª© {{ festival_bookmarks.count|add:travel_bookmarks.count|add:post_bookmarks.count }}ê°œ
        </button>
        <div class="wishlist-list shadow p-4 bg-light rounded">
            
            <!-- ì°œí•œ ì¶•ì œ ëª©ë¡ -->
            <h5>ğŸ‰ ì°œí•œ ì¶•ì œ</h5>
            {% if festival_bookmarks %}
                <ul class="list-unstyled mb-4">
                    {% for bookmark in festival_bookmarks %}
                        <li>
                            <strong>{{ bookmark.festival.name }}</strong><br>
                            ìœ„ì¹˜: {{ bookmark.festival.location }}<br>
                            ê¸°ê°„: {{ bookmark.festival.start_date }} ~ {{ bookmark.festival.end_date }}
                        </li>
                        <hr>
                    {% endfor %}
                </ul>
            {% else %}
                <p>ì°œí•œ ì¶•ì œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endif %}
            
            <!-- ì°œí•œ ì—¬í–‰ì§€ ëª©ë¡ -->
            <h5>ğŸ—ºï¸ ì°œí•œ ì—¬í–‰ì§€</h5>
            {% if travel_bookmarks %}
                <ul class="list-unstyled mb-4">
                    {% for bookmark in travel_bookmarks %}
                        <li>
                            <strong>{{ bookmark.destination.name }}</strong><br>
                            ìœ„ì¹˜: {{ bookmark.destination.location }}<br>
                            ì„¤ëª…: {{ bookmark.destination.description|truncatewords:10 }}
                        </li>
                        <hr>
                    {% endfor %}
                </ul>
            {% else %}
                <p>ì°œí•œ ì—¬í–‰ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endif %}
            
            <!-- ì°œí•œ ê²Œì‹œê¸€ ëª©ë¡ -->
            <h5>ğŸ“ ì°œí•œ ê²Œì‹œê¸€</h5>
            {% if post_bookmarks %}
                <ul class="list-unstyled">
                    {% for bookmark in post_bookmarks %}
                        <li>
                            <strong>{{ bookmark.post.title }}</strong><br>
                            ì‘ì„±ì: {{ bookmark.post.author.username }}<br>
                            ì‘ì„± ë‚ ì§œ: {{ bookmark.post.created_at|date:"Yë…„ mì›” dì¼ H:i" }}
                        </li>
                        <hr>
                    {% endfor %}
                </ul>
            {% else %}
                <p>ì°œí•œ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endif %}
        </div>
    </div>



    <div class="post-list mt-4">
        {% if posts %}
            {% for post in posts %}
                <div class="post-card mb-4">
                    <h3>{{ post.title }}</h3>
                    <p>ì‘ì„±ì: 
                        {% if post.author.first_name %}
                            {{ post.author.first_name }}
                        {% else %}
                            {{ post.author.username }}
                        {% endif %}
                    </p>
                    <p>{{ post.content|truncatewords:20 }}</p>
                    <p>ìœ„ì¹˜: {{ post.location }}</p>

                    <!-- ì‘ì„± ë‚ ì§œ í‘œì‹œ -->
                    <p>ì‘ì„± ë‚ ì§œ: {{ post.created_at|date:"Yë…„ mì›” dì¼ H:i" }}</p>

                    <!-- ë³„ì  í‘œì‹œ ë¶€ë¶„ ìˆ˜ì • -->
                    <p>ë³„ì : 
                        {% for i in "123" %}
                            <span class="{% if i <= post.rating|stringformat:"i" %}text-warning{% else %}text-muted{% endif %}">â˜…</span>
                        {% endfor %}
                    </p>
    
                    <!-- ê²Œì‹œê¸€ ìˆ˜ì • ë° ì‚­ì œ ë²„íŠ¼ (ì‘ì„±ì ë³¸ì¸ë§Œ ë³´ì´ê²Œ) -->
                    {% if post.author == user %}
                        <div class="mt-3">
                            <a href="{% url 'posts:post_update' post.pk %}" class="btn btn-sm btn-outline-primary">ìˆ˜ì •</a>
                            <form method="post" action="{% url 'posts:post_delete' post.pk %}" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì‚­ì œ</button>
                            </form>
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        {% else %}
            <p>ì•„ì§ ì‘ì„±ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endif %}
    </div>
    
    

    <div class="mt-4">
        <a href="{% url 'accounts:logout' %}" class="btn btn-danger">ë¡œê·¸ì•„ì›ƒ</a>
    </div>
</div>
{% endblock content %}

<style>
    /* ìŠ¤íƒ€ì¼ ì„¤ì • */
    .profile-img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 50%;
    }

    .edit-dropdown {
        position: relative;
        display: inline-block;
    }

    .edit-dropdown-form {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        width: 350px;
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        z-index: 10;
    }

    /* ë“œë¡­ë‹¤ìš´ì´ í˜¸ë²„ ì‹œ ë‚˜íƒ€ë‚¨ */
    .edit-dropdown:hover .edit-dropdown-form {
        display: block;
    }

    .edit-dropdown-form form {
        margin-bottom: 20px;
    }

    .btn-outline-secondary {
        cursor: pointer;
    }
    .friends-dropdown {
        position: relative;
        display: inline-block;
    }
    .friends-list {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        width: 200px;
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .friends-dropdown:hover .friends-list {
        display: block;
    }
    .text-warning {
        color: gold;
    }
    .text-muted {
        color: gray;
    }
    .wishlist-dropdown {
        position: relative;
        display: inline-block;
        margin-top: 20px;
    }
    .wishlist-list {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        width: 350px;
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        z-index: 10;
    }
    .wishlist-dropdown:hover .wishlist-list {
        display: block;
    }
    .wishlist-list h5 {
        margin-top: 10px;
        margin-bottom: 10px;
        font-weight: bold;
    }
    .wishlist-list ul {
        padding-left: 0;
    }
    .wishlist-list li {
        margin-bottom: 10px;
    }
    hr {
        border: 0.5px solid #ddd;
    }
</style>
